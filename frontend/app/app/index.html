<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chef Room</title>

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(47,107,255,.18), transparent 50%),
                  radial-gradient(900px 500px at 90% 10%, rgba(255,180,60,.10), transparent 55%),
                  #0b0f17;
      color: #e8eefc;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 22px; }
    .topbar {
      display:flex; align-items:center; justify-content:space-between; gap: 14px;
      padding: 14px 16px; border-radius: 16px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo {
      width: 44px; height: 44px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(47,107,255,1), rgba(255,180,60,0.85));
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      display:grid; place-items:center;
      font-weight: 950;
    }
    .title { font-size: 18px; font-weight: 950; margin:0; }
    .subtitle { font-size: 13px; opacity:.75; margin:0; }

    .tabs { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button {
      border: 0; border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      cursor: pointer;
      color: #e8eefc;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.12);
    }
    button.primary {
      background: #2f6bff;
      border-color: rgba(47,107,255,.45);
      box-shadow: 0 10px 18px rgba(47,107,255,.20);
    }
    button.ghost { background: transparent; }
    button:disabled { opacity: .55; cursor:not-allowed; }

    .grid {
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 16px;
    }
    .card h2 { margin: 0 0 6px; font-size: 18px; font-weight: 950; }
    .muted { opacity:.75; font-size: 13px; line-height: 1.35; }
    .hr { height:1px; background: rgba(255,255,255,0.10); border:0; margin: 14px 0; }

    .pillrow { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px; border-radius: 999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.12);
      font-weight: 900;
      font-size: 13px;
    }
    .pill .dot { width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,.45); }
    .pill.good .dot { background: rgba(0,255,170,.65); }
    .pill.warn .dot { background: rgba(255,180,60,.75); }

    .stack { display:grid; gap:10px; }
    input, textarea {
      width: 100%;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.12);
      color: #e8eefc;
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    textarea { min-height: 110px; resize: vertical; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row > * { flex: 1; min-width: 180px; }
    .row .fit { flex: 0 0 auto; min-width: auto; }

    .bigCTA {
      display:flex; gap: 12px; align-items:center; justify-content:space-between;
      padding: 14px 14px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(47,107,255,.18), rgba(255,180,60,.10));
      border: 1px solid rgba(255,255,255,0.12);
    }
    .bigCTA .left { display:grid; gap: 4px; }
    .bigCTA .left .headline { font-weight: 950; font-size: 16px; }
    .bigCTA .left .sub { font-size: 13px; opacity: .8; }

    .steps3 { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    @media (max-width: 980px) { .steps3 { grid-template-columns: 1fr; } }
    .mini h3 { margin:0 0 6px; font-size: 14px; font-weight: 950; }
    .mini textarea { min-height: 180px; }

    .list { margin: 8px 0 0; padding-left: 18px; }
    .linkbox { display:flex; gap:10px; align-items:center; }
    .linkbox input { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .toast { font-size: 13px; opacity:.8; }

    /* Chef cards */
    .chefCard {
      padding: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .task {
      display:flex; gap: 10px; align-items:flex-start;
      padding: 10px; border-radius: 12px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .task input { width: 18px; height:18px; margin-top: 2px; }
    .task .tTitle { font-weight: 950; font-size: 13px; }
    .task .tText { font-size: 13px; opacity: .85; line-height: 1.35; }

    .hide { display:none; }
    .infoIcon { cursor:pointer; opacity:.8; user-select:none; }
    .tooltip { position: relative; display:inline-block; }
    .tip {
      position:absolute;
      top: 28px; right: 0;
      width: 280px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(10,14,24,0.98);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 12px;
      opacity: .9;
      display:none;
      z-index: 10;
    }
    .tooltip:hover .tip { display:block; }

    /* ---- NEW: stripped-down host control styles ---- */
    .host-wrap { max-width: 1100px; margin: 0 auto; padding: 0; }
    .host-header { display:flex; justify-content:space-between; align-items:flex-end; gap: 12px; margin-bottom: 14px; }
    .host-header h1 { margin:0; font-size: 22px; font-weight: 950; letter-spacing: .2px; }
    .host-header p { margin: 6px 0 0; font-size: 13px; opacity: .70; }
    .host-main { display:grid; grid-template-columns: 1fr; gap: 14px; }
    .recipe-box {
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.16);
      padding: 14px;
      border-radius: 14px;
    }
    .recipe-box label { font-weight: 900; font-size: 13px; opacity: .9; }
    .recipe-box textarea {
      min-height: 140px;
      margin-top: 10px;
      border-radius: 12px;
    }
    .recipe-actions { display:flex; gap: 10px; margin-top: 12px; flex-wrap:wrap; }
    button.secondary {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      color: #e8eefc;
      border-radius: 12px;
    }
    .assignments { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    @media (max-width: 980px) { .assignments { grid-template-columns: 1fr; } }
    .chef-col h3 { margin:0 0 8px; font-size: 14px; font-weight: 950; }
    .chef-col textarea { min-height: 180px; border-radius: 12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">üç≥</div>
        <div>
          <p class="title">Chef Room</p>
          <p class="subtitle">Host inputs a recipe ‚Üí assigns steps ‚Üí 3 chefs execute.</p>
        </div>
      </div>
      <div class="tabs">
        <button id="tabHome">Home</button>
        <button id="tabHost">Control Kitchen</button>
        <button id="tabChef">Join as Chef</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: HOME -->
      <div class="card" id="homeView">
        <h2>Start cooking</h2>
        <div class="muted">Create a room, paste the recipe, and share chef links.</div>

        <div class="hr"></div>

        <div class="bigCTA">
          <div class="left">
            <div class="headline">Step 1 ‚Äî Create a room</div>
            <div class="sub">You‚Äôll get a room code + chef links.</div>
          </div>
          <button class="primary" id="createRoomBtn">Start Cooking</button>
        </div>

        <div class="hr"></div>

        <h2>Join an existing room</h2>
        <div class="muted">
          If you‚Äôre testing in the same browser, load by code.
          <span class="tooltip">
            <span class="infoIcon">‚ÑπÔ∏è</span>
            <span class="tip">
              Frontend-only demo: live syncing works best across tabs on the same computer.
              Multi-device ‚Äúlive‚Äù needs a backend or realtime database.
            </span>
          </span>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <input id="roomCodeInput" placeholder="ROOM CODE (e.g. A1B2C3)" />
          <button class="fit" id="loadRoomBtn">Load</button>
        </div>
      </div>

      <!-- RIGHT: QUICK STATUS -->
      <div class="card" id="statusView">
        <h2>Kitchen status</h2>
        <div class="muted">Room, chefs, progress ‚Äî at a glance.</div>

        <div class="hr"></div>

        <div class="pillrow">
          <span class="pill warn"><span class="dot"></span> Room: <span id="roomCodeLabel">‚Äî</span></span>
          <span class="pill"><span class="dot"></span> Recipe: <span id="recipeLabel">none</span></span>
        </div>

        <div style="height:10px"></div>

        <div class="pillrow">
          <span class="pill"><span class="dot"></span> Chef 1: <span id="chef1Label">free</span></span>
          <span class="pill"><span class="dot"></span> Chef 2: <span id="chef2Label">free</span></span>
          <span class="pill"><span class="dot"></span> Chef 3: <span id="chef3Label">free</span></span>
        </div>

        <div class="hr"></div>

        <div class="pillrow">
          <span class="pill good"><span class="dot"></span> Progress C1: <span id="p1">0/0</span></span>
          <span class="pill good"><span class="dot"></span> C2: <span id="p2">0/0</span></span>
          <span class="pill good"><span class="dot"></span> C3: <span id="p3">0/0</span></span>
        </div>

        <div style="height:12px"></div>
        <div class="muted">Tip: paste steps (one per line), then split + share links.</div>
      </div>
    </div>

    <!-- HOST VIEW (single-screen flow) -->
    <div class="card hide" id="hostView" style="margin-top:14px;">
      <div class="host-wrap">
        <div class="host-header">
          <div class="left">
            <h1>Run the Kitchen</h1>
            <p>Room <span id="hostRoomCode">‚Äî</span></p>
          </div>
          <div class="right">
            <button class="ghost" id="copyAllLinksBtn" title="Copy chef links from the recipe card after you send.">Copy Chef Links</button>
          </div>
        </div>

        <div class="host-main">
          <div class="recipe-box">
            <label>Recipe steps (one step per line)</label>
            <textarea id="promptBox" placeholder="1. Start rice&#10;2. Cut chicken&#10;3. Heat pan&#10;4. Cook chicken&#10;5. Plate"></textarea>

            <div class="recipe-actions">
              <button class="primary" id="genBtn">Send to Chefs</button>
              <button class="secondary" id="autoSplitBtn">Split Automatically</button>
              <span class="toast" id="hostToast"></span>
            </div>
          </div>

          <div class="assignments">
            <div class="chef-col">
              <h3>Chef 1</h3>
              <textarea id="a1" placeholder="Steps for Chef 1"></textarea>
            </div>
            <div class="chef-col">
              <h3>Chef 2</h3>
              <textarea id="a2" placeholder="Steps for Chef 2"></textarea>
            </div>
            <div class="chef-col">
              <h3>Chef 3</h3>
              <textarea id="a3" placeholder="Steps for Chef 3"></textarea>
            </div>
          </div>

          <!-- Hidden recipe card area (kept only to preserve link functionality) -->
          <div class="hide" id="recipeCard" aria-hidden="true">
            <input id="l1" readonly />
            <input id="l2" readonly />
            <input id="l3" readonly />
            <span id="rTitle"></span>
            <span id="rServ"></span>
            <span id="rMin"></span>
            <ul id="rIng"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- CHEF VIEW -->
    <div class="card hide" id="chefView" style="margin-top:14px;">
      <div class="row" style="align-items:center;">
        <div style="flex:1;">
          <h2 style="margin:0;">Join as Chef</h2>
          <div class="muted">Open a chef link from the host, or join by code (same browser).</div>
        </div>
        <span class="pill"><span class="dot"></span> Role: <span id="chefRoleLabel">‚Äî</span></span>
      </div>

      <div class="hr"></div>

      <div class="row">
        <input id="chefCode" placeholder="Room code (optional if using link)" />
        <input id="chefName" placeholder="Your name (optional)" />
        <button class="fit" data-join="chef1">Chef 1</button>
        <button class="fit" data-join="chef2">Chef 2</button>
        <button class="fit" data-join="chef3">Chef 3</button>
      </div>

      <div class="hr"></div>

      <div class="chefCard hide" id="chefPanel">
        <div class="pillrow">
          <span class="pill warn"><span class="dot"></span> Room: <span id="chefRoomLabel">‚Äî</span></span>
          <span class="pill"><span class="dot"></span> Recipe: <span id="chefRecipe">‚Äî</span></span>
        </div>

        <div style="height:10px"></div>
        <div class="stack" id="chefTasks"></div>
      </div>
    </div>
  </div>

  <script>
    // ---------- tiny state (frontend only) ----------
    const ROLES = ["chef1","chef2","chef3"];
    const $ = (id) => document.getElementById(id);

    function makeCode(){ return Math.random().toString(16).slice(2,8).toUpperCase(); }
    function keyRoom(code){ return "chefroom:" + code; }
    function keyProg(code, role){ return "chefprog:" + code + ":" + role; }

    function saveRoom(code, room){ localStorage.setItem(keyRoom(code), JSON.stringify(room)); }
    function loadRoom(code){
      try { const raw = localStorage.getItem(keyRoom(code)); return raw ? JSON.parse(raw) : null; }
      catch { return null; }
    }
    function saveProg(code, role, map){ localStorage.setItem(keyProg(code,role), JSON.stringify(map||{})); }
    function loadProg(code, role){
      try { const raw = localStorage.getItem(keyProg(code,role)); return raw ? JSON.parse(raw) : {}; }
      catch { return {}; }
    }

    function b64urlEncode(str){
      return btoa(unescape(encodeURIComponent(str))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","");
    }
    function b64urlDecode(str){
      const pad = str.length % 4 ? "=".repeat(4 - (str.length % 4)) : "";
      const base64 = (str + pad).replaceAll("-","+").replaceAll("_","/");
      return decodeURIComponent(escape(atob(base64)));
    }

    function qs(){
      const u = new URL(location.href);
      const out = {};
      u.searchParams.forEach((v,k)=>out[k]=v);
      return out;
    }
    function setQuery(obj){
      const u = new URL(location.href);
      Object.keys(obj).forEach(k=>{
        if(obj[k]===null || obj[k]===undefined || obj[k]==="") u.searchParams.delete(k);
        else u.searchParams.set(k, obj[k]);
      });
      history.replaceState({}, "", u.toString());
    }

    function split3(arr){
      const a = Array.isArray(arr) ? arr : [];
      const n = a.length;
      const size = Math.ceil(n/3) || 1;
      return [a.slice(0,size), a.slice(size,size*2), a.slice(size*2)];
    }

    // ---------- app vars ----------
    let roomCode = "";
    let room = null;
    let chefRole = "chef1";

    // ---------- view switching ----------
    function show(view){
      $("homeView").classList.toggle("hide", view !== "home");
      $("hostView").classList.toggle("hide", view !== "host");
      $("chefView").classList.toggle("hide", view !== "chef");
      setQuery({ view });
      if(view==="home") renderStatus();
      if(view==="host") renderHost();
      if(view==="chef") renderChefLanding();
    }

    // ---------- status panel ----------
    function renderStatus(){
      $("roomCodeLabel").textContent = roomCode || "‚Äî";
      $("recipeLabel").textContent = room?.recipe?.title ? "ready" : "none";
      $("chef1Label").textContent = room?.chefs?.chef1 || "free";
      $("chef2Label").textContent = room?.chefs?.chef2 || "free";
      $("chef3Label").textContent = room?.chefs?.chef3 || "free";

      ROLES.forEach((r, idx)=>{
        const steps = room?.assignments?.[r] || [];
        const prog = roomCode ? loadProg(roomCode, r) : {};
        const done = Object.values(prog).filter(Boolean).length;
        const total = steps.length;
        const el = idx===0 ? $("p1") : idx===1 ? $("p2") : $("p3");
        el.textContent = `${done}/${total}`;
      });
    }

    // ---------- host ----------
    function buildChefLink(role){
      const base = location.href.split("?")[0];
      const data = b64urlEncode(JSON.stringify(room));
      return `${base}?view=chef&role=${role}&data=${data}`;
    }

    function renderHost(){
      if(!room) return;

      $("hostRoomCode").textContent = roomCode;
      renderStatus();

      // default helper text
      if(!$("promptBox").value.trim()){
        $("promptBox").value =
`Start rice
Cut chicken
Heat pan
Cook chicken
Plate food`;
      }

      // keep hidden link inputs updated so chefs can join
      $("l1").value = buildChefLink("chef1");
      $("l2").value = buildChefLink("chef2");
      $("l3").value = buildChefLink("chef3");

      // keep assignment boxes in sync with room state
      $("a1").value = (room.assignments?.chef1 || []).join("\n");
      $("a2").value = (room.assignments?.chef2 || []).join("\n");
      $("a3").value = (room.assignments?.chef3 || []).join("\n");
    }

    function persist(){
      if(!roomCode || !room) return;
      saveRoom(roomCode, room);
      renderStatus();
    }

    // Send recipe (host input) -> split -> assign
    $("genBtn").onclick = () => {
      if(!room) return;

      room.recipe = { title: "Host Recipe", servings: 0, total_minutes: 0, ingredients: [], instructions: [] };
      room.recipe.instructions = $("promptBox").value.split("\n").map(s=>s.trim()).filter(Boolean);

      const [c1,c2,c3] = split3(room.recipe.instructions);
      room.assignments = { chef1:c1, chef2:c2, chef3:c3 };

      ROLES.forEach(role => localStorage.removeItem(keyProg(roomCode, role))); // reset progress
      $("hostToast").textContent = "Sent. Split applied ‚Äî edit assignments if needed.";
      persist();
      renderHost();
    };

    $("autoSplitBtn").onclick = () => {
      if(!room?.recipe?.instructions) return;
      const [c1,c2,c3] = split3(room.recipe.instructions);
      room.assignments = { chef1:c1, chef2:c2, chef3:c3 };
      $("hostToast").textContent = "Re-split steps.";
      persist();
      renderHost();
    };

    function assignChanged(){
      if(!room) return;
      room.assignments.chef1 = $("a1").value.split("\n").map(s=>s.trim()).filter(Boolean);
      room.assignments.chef2 = $("a2").value.split("\n").map(s=>s.trim()).filter(Boolean);
      room.assignments.chef3 = $("a3").value.split("\n").map(s=>s.trim()).filter(Boolean);
      persist();
    }
    ["a1","a2","a3"].forEach(id => $(id).addEventListener("input", assignChanged));

    // Copy chef links button
    $("copyAllLinksBtn").onclick = async () => {
      if(!room) return;
      const text =
`Chef 1: ${$("l1").value}
Chef 2: ${$("l2").value}
Chef 3: ${$("l3").value}`;
      try {
        await navigator.clipboard.writeText(text);
        $("hostToast").textContent = "Chef links copied.";
      } catch {
        $("hostToast").textContent = "Clipboard blocked ‚Äî copy from the address bar after sending.";
      }
    };

    // ---------- chef ----------
    function renderChefLanding(){
      $("chefPanel").classList.add("hide");
      const q = qs();
      if(q.role && ROLES.includes(q.role)) chefRole = q.role;

      // if opened via link
      if(q.data){
        try{
          room = JSON.parse(b64urlDecode(q.data));
          roomCode = room.code || "";
          saveRoom(roomCode, room);
          $("chefCode").value = roomCode;
          joinChef(chefRole);
          return;
        } catch {}
      }

      // if joining by code (same browser)
      if(q.code){
        const c = String(q.code).toUpperCase();
        const existing = loadRoom(c);
        if(existing){ room = existing; roomCode = c; $("chefCode").value = c; renderStatus(); }
      }

      $("chefRoleLabel").textContent = chefRole.toUpperCase();
    }

    function joinChef(role){
      const code = ($("chefCode").value || roomCode || "").trim().toUpperCase();
      if(!code) return alert("Enter a room code or use a chef link.");

      if(!room || !roomCode){
        const existing = loadRoom(code);
        if(!existing) return alert("Room not found in this browser. Use a chef link from host.");
        room = existing;
        roomCode = code;
      }

      chefRole = role;
      $("chefRoleLabel").textContent = role.toUpperCase();
      $("chefRoomLabel").textContent = roomCode;
      $("chefRecipe").textContent = room?.recipe?.title || "Waiting‚Ä¶";

      const nm = ($("chefName").value || role.toUpperCase()).trim().slice(0,24);
      room.chefs = room.chefs || { chef1:null, chef2:null, chef3:null };
      if(room.chefs[role] && room.chefs[role] !== nm){
        return alert(role.toUpperCase() + " already taken in this browser.");
      }
      room.chefs[role] = nm;
      persist();

      const steps = room.assignments?.[role] || [];
      const prog = loadProg(roomCode, role);
      $("chefTasks").innerHTML = "";

      if(!steps.length){
        const d = document.createElement("div");
        d.className = "muted";
        d.textContent = "No steps assigned yet. Waiting on host‚Ä¶";
        $("chefTasks").appendChild(d);
      } else {
        steps.forEach((step, i)=>{
          const box = document.createElement("label");
          box.className = "task";

          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.checked = !!prog[i];

          const body = document.createElement("div");
          const t1 = document.createElement("div");
          t1.className = "tTitle";
          t1.textContent = "Step " + (i+1);

          const t2 = document.createElement("div");
          t2.className = "tText";
          t2.textContent = step;
          t2.style.opacity = cb.checked ? "0.55" : "0.9";

          cb.addEventListener("change", ()=>{
            prog[i] = cb.checked;
            saveProg(roomCode, role, prog);
            t2.style.opacity = cb.checked ? "0.55" : "0.9";
            renderStatus();
          });

          body.appendChild(t1);
          body.appendChild(t2);
          box.appendChild(cb);
          box.appendChild(body);
          $("chefTasks").appendChild(box);
        });
      }

      $("chefPanel").classList.remove("hide");
      setQuery({ view:"chef", role, code: roomCode });
    }

    document.querySelectorAll("[data-join]").forEach(btn=>{
      btn.addEventListener("click", ()=> joinChef(btn.getAttribute("data-join")));
    });

    // ---------- home buttons ----------
    $("createRoomBtn").onclick = () => {
      roomCode = makeCode();
      room = {
        code: roomCode,
        recipe: null,
        assignments: { chef1:[], chef2:[], chef3:[] },
        chefs: { chef1:null, chef2:null, chef3:null }
      };
      saveRoom(roomCode, room);
      renderStatus();
      show("host");
    };

    $("loadRoomBtn").onclick = () => {
      const c = ($("roomCodeInput").value || "").trim().toUpperCase();
      if(!c) return;
      const existing = loadRoom(c);
      if(!existing) return alert("Room not found in this browser.");
      roomCode = c;
      room = existing;
      renderStatus();
      show("host");
    };

    // tabs
    $("tabHome").onclick = () => show("home");
    $("tabHost").onclick = () => show("host");
    $("tabChef").onclick = () => show("chef");

    // storage sync across tabs (same device)
    window.addEventListener("storage", (e)=>{
      if(!roomCode) return;
      if(e.key === keyRoom(roomCode)){
        const updated = loadRoom(roomCode);
        if(updated){ room = updated; renderStatus(); if(qs().view==="host") renderHost(); }
      }
      if(e.key && e.key.startsWith("chefprog:" + roomCode + ":")){
        renderStatus();
      }
    });

    // boot
    (function init(){
      const q = qs();
      const v = q.view || "home";

      if(v === "host" && q.code){
        const existing = loadRoom(String(q.code).toUpperCase());
        if(existing){ room = existing; roomCode = existing.code || String(q.code).toUpperCase(); }
      }

      renderStatus();
      show(v === "host" ? "host" : v === "chef" ? "chef" : "home");
    })();
  </script>
</body>
</html>
